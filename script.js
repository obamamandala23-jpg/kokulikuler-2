// Data Kearifan Lokal Indonesia (YouTube dihapus, gambar tetap sama)
const budayaData = {
    "sumatera-barat": {
        nama: "Sumatera Barat",
        fotoUtama: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTK_bjKubYNIvgqxWPV3GrZVT0muPxlmcmk-w&s",
        deskripsi: "Sumatera Barat merupakan rumah bagi masyarakat Minangkabau yang terkenal dengan filosofi 'Alam Takambang Jadi Guru' (Alam Terbentang Menjadi Guru). Kebudayaan Minangkabau sangat kaya dengan nilai-nilai kearifan lokal yang terjaga turun-temurun.",
        kearifan: [
            {
                id: 1,
                judul: "Rumah Gadang",
                gambar: "https://storage.googleapis.com/arsitagx-master-article/article-photo/109/unnamed.jpg",
                deskripsiSingkat: "Rumah adat Minangkabau dengan atap gonjong yang melambangkan tanduk kerbau",
                deskripsiPanjang: "Rumah Gadang adalah rumah adat Minangkabau yang memiliki arsitektur unik dengan atap bergonjong menyerupai tanduk kerbau. Rumah ini bukan hanya sekedar tempat tinggal, melainkan simbol dari sistem matrilineal yang dianut masyarakat Minang. Setiap bagian rumah memiliki makna filosofis yang dalam, mulai dari bentuk atap yang melambangkan persatuan hingga ruangan yang mencerminkan struktur sosial masyarakat.",
                fakta: [
                    "Atap gonjong melambangkan tanduk kerbau yang dianggap hewan terhormat",
                    "Tidak menggunakan paku, hanya pasak kayu",
                    "Ruangannya mencerminkan sistem matrilineal",
                    "Setiap ukiran memiliki makna filosofis tersendiri",
                    "Bangunan tahan gempa karena struktur yang fleksibel"
                ]
            },
            {
                id: 2,
                judul: "Sistem Matrilineal",
                gambar: "https://cnc-magazine.oramiland.com/parenting/images/matrilineal.width-800.format-webp.webp",
                deskripsiSingkat: "Sistem kekerabatan yang menarik garis keturunan dari pihak ibu",
                deskripsiPanjang: "Sistem Matrilineal adalah sistem kekerabatan yang menarik garis keturunan dari pihak ibu. Dalam masyarakat Minangkabau, harta pusaka seperti rumah gadang, sawah, dan ladang diwariskan dari ibu kepada anak perempuan. Laki-laki dalam sistem ini berperan sebagai mamak (paman) yang bertanggung jawab terhadap kemenakan (anak dari saudara perempuan).",
                fakta: [
                    "Satu-satunya sistem matrilineal terbesar di dunia",
                    "Harta pusaka diwariskan dari ibu ke anak perempuan",
                    "Laki-laki berperan sebagai mamak (paman) untuk kemenakan",
                    "Pernikahan tidak mengubah status kekerabatan perempuan",
                    "Sistem ini telah bertahan lebih dari 500 tahun"
                ]
            },
            {
                id: 3,
                judul: "Adat Syarak",
                gambar: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSSiXvJoAtfMa_CwWjOscqNnaIW_N-lnHG0CQ&s",
                deskripsiSingkat: "Penyelarasan antara adat istiadat dengan hukum Islam",
                deskripsiPanjang: "Adat Basandi Syarak, Syarak Basandi Kitabullah (ABS-SBK) adalah filosofi dasar masyarakat Minangkabau yang berarti adat bersendikan syariat, syariat bersendikan Al-Quran. Konsep ini menunjukkan bagaimana masyarakat Minang berhasil menyelaraskan tradisi lokal dengan ajaran Islam. Adat Syarak mengatur berbagai aspek kehidupan, mulai dari upacara adat, penyelesaian sengketa, hingga tata cara bermasyarakat.",
                fakta: [
                    "Prinsip ABS-SBK telah ada sejak abad ke-16",
                    "Menggabungkan hukum adat dengan syariat Islam",
                    "Digunakan dalam penyelesaian sengketa masyarakat",
                    "Mengatur berbagai upacara adat dan tradisi",
                    "Menjadi pedoman moral dan etika bermasyarakat"
                ]
            }
        ],
        coordinates: [ -0.95, 100.353 ] // Koordinat untuk Sumatera Barat
    },
    "yogyakarta": {
        nama: "Yogyakarta",
        fotoUtama: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRHs-sNWVydasiYjM0A_k2y7wZnq_hREVP-1A&s",
        deskripsi: "Yogyakarta merupakan pusat kebudayaan Jawa yang kaya dengan filosofi hidup dan tradisi yang terjaga sejak ratusan tahun. Sebagai kota kerajaan, Yogyakarta memadukan nilai-nilai spiritual, seni, dan kearifan lokal dalam kehidupan sehari-hari.",
        kearifan: [
            {
                id: 1,
                judul: "Sumbu Filosofi",
                gambar: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS-HkWyfFeNTpOOO_Hj5RUmd745KTgqqs3F5w&s",
                deskripsiSingkat: "Konsep tata kota yang menghubungkan Gunung Merapi, Keraton, dan Laut Selatan",
                deskripsiPanjang: "Sumbu Filosofi Yogyakarta adalah konsep tata ruang kota yang menghubungkan tiga elemen utama: Gunung Merapi (utara), Keraton Yogyakarta (tengah), dan Laut Selatan (Pantai Parangkusumo). Konsep ini melambangkan hubungan harmonis antara manusia dengan Tuhan, alam, dan sesama manusia. Sumbu imajiner sepanjang 6 kilometer ini menjadi dasar penataan seluruh bangunan dan tata kota Yogyakarta.",
                fakta: [
                    "Panjang sumbu filosofi sekitar 6 kilometer",
                    "Menghubungkan tiga elemen kosmis: gunung, keraton, laut",
                    "Dijadikan dasar penataan kota sejak abad ke-18",
                    "Melambangkan hubungan manusia dengan alam semesta",
                    "Diakui sebagai warisan budaya dunia oleh UNESCO"
                ]
            },
            {
                id: 2,
                judul: "Keraton Yogyakarta",
                gambar: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRFzD2FQ6UvKeR10iLcEZv5iOcJ0ETgcYTznQ&s",
                deskripsiSingkat: "Istana Kasultanan Yogyakarta sebagai pusat budaya dan spiritual",
                deskripsiPanjang: "Keraton Yogyakarta bukan hanya istana tempat tinggal sultan, melainkan pusat kebudayaan, spiritual, dan pemerintahan. Setiap bagian keraton memiliki makna filosofis yang dalam, mulai dari gerbang, bangunan, hingga tata letaknya. Keraton menjadi living museum yang tetap mempertahankan tradisi dan adat istiadat Jawa.",
                fakta: [
                    "Didirikan oleh Sri Sultan Hamengkubuwono I pada 1755",
                    "Arsitekturnya menggabungkan Jawa, Hindu, dan Islam",
                    "Masih menjadi pusat budaya dan tradisi Jawa",
                    "Setiap bangunan memiliki makna filosofis tertentu",
                    "Rutin mengadakan upacara adat tradisional"
                ]
            },
            {
                id: 3,
                judul: "Batik Yogyakarta",
                gambar: "https://media.istockphoto.com/id/1195546987/photo/making-batik-tulis.jpg?s=612x612&w=0&k=20&c=Bk8bYWtEsdCuFP1VcRWatJoiEzD94V56mf8ZIplfGRA=",
                deskripsiSingkat: "Seni membatik dengan motif dan filosofi yang mendalam",
                deskripsiPanjang: "Batik Yogyakarta memiliki karakteristik khusus dengan dominasi warna sogan (coklat) dan motif-motif yang penuh makna filosofis. Setiap motif batik mengandung pesan moral, doa, atau harapan bagi pemakainya. Proses membatik dilakukan secara tradisional dengan canting dan malam, membutuhkan kesabaran dan ketelitian tinggi.",
                fakta: [
                    "Motif batik mengandung filosofi hidup masyarakat Jawa",
                    "Warna sogan berasal dari pewarna alami kayu tingi",
                    "Proses pembuatan bisa memakan waktu berminggu-minggu",
                    "Setiap motif memiliki makna dan kegunaan khusus",
                    "Diakui UNESCO sebagai Warisan Kemanusiaan"
                ]
            }
        ],
        coordinates: [ -7.7956, 110.3695 ] // Koordinat untuk Yogyakarta
    },
    "bali": {
        nama: "Bali",
        fotoUtama: "https://media.istockphoto.com/id/675172642/id/foto/pura-ulun-danu-bratan-temple-in-bali.jpg?b=1&s=612x612&w=0&k=20&c=mdCbleljXo3esVbxeJlSsKR1GzfDZI-bHkxmiMvfQuQ=",
        deskripsi: "Bali dikenal sebagai Pulau Dewata dengan kearifan lokal yang terwujud dalam konsep Tri Hita Karana. Masyarakat Bali hidup dalam harmoni antara hubungan dengan Tuhan, sesama manusia, dan alam sekitarnya.",
        kearifan: [
            {
                id: 1,
                judul: "Tri Hita Karana",
                gambar: "https://www.marketeers.com/_next/image/?url=https%3A%2F%2Fimagedelivery.net%2F2MtOYVTKaiU0CCt-BLmtWw%2F18c4d7b2-7f79-432c-c035-84b57bb54100%2Fw%3D2560&w=1920&q=75",
                deskripsiSingkat: "Konsep tiga penyebab kebahagiaan: hubungan dengan Tuhan, manusia, dan alam",
                deskripsiPanjang: "Tri Hita Karana adalah filosofi hidup masyarakat Bali yang berarti tiga penyebab kebahagiaan. Konsep ini mengajarkan pentingnya menjaga hubungan harmonis dalam tiga aspek: Parahyangan (hubungan dengan Tuhan), Pawongan (hubungan dengan sesama manusia), dan Palemahan (hubungan dengan alam).",
                fakta: [
                    "Dianut sejak abad ke-14",
                    "Menjadi dasar sistem subak di Bali",
                    "Mempengaruhi tata letak bangunan dan desa",
                    "Diimplementasikan dalam kehidupan sehari-hari",
                    "Menjadi kunci kelestarian budaya Bali"
                ]
            },
            {
                id: 2,
                judul: "Sistem Subak",
                gambar: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTNM80fuyLi89mpBxf5t2nWrtQ6dOEENlOQuQ&s",
                deskripsiSingkat: "Sistem irigasi tradisional Bali yang berbasis komunitas dan spiritual",
                deskripsiPanjang: "Subak adalah sistem irigasi tradisional Bali yang telah ada sejak abad ke-9. Sistem ini bukan hanya tentang pengelolaan air, melainkan juga tentang filosofi hidup, kerja sama komunitas, dan nilai-nilai spiritual. Setiap subak dikelola oleh kelompok petani yang bekerja sama dalam membagi air secara adil.",
                fakta: [
                    "Sudah ada sejak abad ke-9",
                    "Diakui UNESCO sebagai Warisan Budaya Dunia",
                    "Menggabungkan aspek teknis, sosial, dan spiritual",
                    "Dikelola secara demokratis oleh kelompok petani",
                    "Menjadi model pengelolaan air berkelanjutan"
                ]
            },
            {
                id: 3,
                judul: "Upacara Keagamaan",
                gambar: "https://awsimages.detik.net.id/community/media/visual/2022/06/08/khusyuk-umat-hindu-rayakan-galungan-di-pura-aditya-jaya-4.jpeg?w=4500",
                deskripsiSingkat: "Ritual dan upacara yang menjadi bagian tak terpisahkan dari kehidupan",
                deskripsiPanjang: "Pura (tempat suci) dan upacara keagamaan adalah jantung dari kehidupan spiritual masyarakat Bali. Terdapat tiga jenis pura utama: Pura Kahyangan Jagat (untuk dewa-dewa utama), Pura Kawitan (untuk leluhur), dan Pura Swagina (untuk profesi tertentu).",
                fakta: [
                    "Ada lebih dari 20,000 pura di Bali",
                    "Upacara dilakukan setiap hari, bulan, dan tahun",
                    "Setiap pura memiliki fungsi dan dewa yang berbeda",
                    "Upacara melibatkan seni tari, musik, dan sesaji",
                    "Menjadi daya tarik budaya utama Bali"
                ]
            }
        ],
        coordinates: [ -8.4095, 115.1889 ] // Koordinat untuk Bali
    },
    "toraja": {
        nama: "Toraja",
        fotoUtama: "https://media-cdn.tripadvisor.com/media/photo-c/1280x250/10/3b/75/8f/tana-toraja.jpg",
        deskripsi: "Tanah Toraja di Sulawesi Selatan menyimpan kekayaan budaya yang unik, terutama dalam hal rumah adat dan tradisi pemakaman. Masyarakat Toraja memiliki hubungan yang sangat erat dengan leluhur dan alam sekitar.",
        kearifan: [
            {
                id: 1,
                judul: "Rumah Tongkonan",
                gambar: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQBeeJ5GmnuiwO-psTwYz1ZZVEhDuuIdjlI7A&s",
                deskripsiSingkat: "Rumah adat Toraja dengan atap melengkung seperti perahu",
                deskripsiPanjang: "Tongkonan adalah rumah adat Toraja yang memiliki atap melengkung menyerupai perahu. Rumah ini bukan hanya tempat tinggal, melainkan juga pusat kehidupan sosial, spiritual, dan adat masyarakat Toraja. Setiap Tongkonan memiliki sejarah dan silsilah keluarga tertentu.",
                fakta: [
                    "Atap melengkung melambangkan perahu leluhur",
                    "Tidak menggunakan paku dalam konstruksi",
                    "Setiap ukiran memiliki makna simbolis",
                    "Menjadi pusat kegiatan adat dan keluarga",
                    "Dibangun menghadap utara (arah kehidupan)"
                ]
            },
            {
                id: 2,
                judul: "Rambu Solo'",
                gambar: "https://indonesiajuara.asia/wp-content/uploads/2025/07/Mapalao-Ritual-Adat-Rambu-Solo-Suku-Toraja-source-instagram-@visit_sulsel-e1752301595259-1024x576.webp",
                deskripsiSingkat: "Upacara pemakaman yang megah sebagai penghormatan terakhir",
                deskripsiPanjang: "Rambu Solo' adalah upacara pemakaman adat Toraja yang dilakukan secara besar-besaran sebagai bentuk penghormatan terakhir kepada orang yang meninggal. Upacara ini bisa berlangsung selama beberapa hari bahkan minggu, melibatkan seluruh keluarga dan komunitas.",
                fakta: [
                    "Bisa berlangsung hingga berminggu-minggu",
                    "Melibatkan penyembelihan kerbau sebagai persembahan",
                    "Jenazah disemayamkan di Tongkonan sebelum dikubur",
                    "Makam biasanya di tebing atau liang batu",
                    "Menjadi atraksi budaya penting Toraja"
                ]
            },
            {
                id: 3,
                judul: "Aluk Todolo",
                gambar: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSPvV9rIAagLjH0GAdYbDVjQsY4t8-CJ61pog&s",
                deskripsiSingkat: "Sistem kepercayaan dan aturan adat masyarakat Toraja",
                deskripsiPanjang: "Aluk Todolo atau 'jalan leluhur' adalah sistem kepercayaan tradisional masyarakat Toraja yang mengatur seluruh aspek kehidupan, dari kelahiran, pernikahan, hingga kematian. Kepercayaan ini memadukan animisme, dinamisme, dan penghormatan kepada leluhur.",
                fakta: [
                    "Sistem kepercayaan turun-temurun",
                    "Mengatur seluruh siklus kehidupan manusia",
                    "Memadukan animisme dan penghormatan leluhur",
                    "Masih dipraktikkan bersama agama resmi",
                    "Menjadi dasar seluruh upacara adat Toraja"
                ]
            }
        ],
        coordinates: [ -2.9991, 119.8530 ] // Koordinat untuk Toraja
    },
    "papua": {
        nama: "Papua",
        fotoUtama: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRf-2JtJf4pIp57arHYRhTYuLfZnyz_PDn8WA&s",
        deskripsi: "Papua, tanah surga di timur Indonesia, menyimpan kekayaan budaya yang sangat beragam. Masyarakat Papua hidup harmonis dengan alam dan memiliki kearifan lokal dalam mengelola sumber daya secara berkelanjutan.",
        kearifan: [
            {
                id: 1,
                judul: "Noken",
                gambar: "https://www.djkn.kemenkeu.go.id/files/images/2022/06/noken-raja-ampat.jpg",
                deskripsiSingkat: "Tas rajutan dari serat kayu yang menjadi simbol kehidupan perempuan Papua",
                deskripsiPanjang: "Noken adalah tas tradisional Papua yang dibuat dengan teknik merajut atau menganyam dari serat kayu, kulit kayu, atau daun pandan. Tas ini bukan hanya alat untuk membawa barang, melainkan simbol kehidupan, identitas budaya, dan kreativitas perempuan Papua.",
                fakta: [
                    "Ditetapkan UNESCO sebagai Warisan Budaya Dunia",
                    "Hanya dibuat oleh perempuan Papua",
                    "Teknik pembuatan berbeda di setiap suku",
                    "Digunakan untuk menggendong bayi dan barang",
                    "Simbol kedewasaan perempuan Papua"
                ]
            },
            {
                id: 2,
                judul: "Sistem Sasi",
                gambar: "https://1001indonesia.net/asset/2022/11/Tradisi-Sasi-1.jpg",
                deskripsiSingkat: "Sistem pengelolaan sumber daya alam berbasis adat",
                deskripsiPanjang: "Sasi adalah sistem pengelolaan sumber daya alam berbasis adat yang diterapkan masyarakat Papua, khususnya di Maluku dan Papua Barat. Sistem ini mengatur waktu panen, ukuran tangkapan, dan cara pengambilan hasil alam agar tetap berkelanjutan.",
                fakta: [
                    "Sudah diterapkan sejak ratusan tahun",
                    "Dikelola oleh kepala adat dan masyarakat",
                    "Melindungi sumber daya alam dari eksploitasi",
                    "Ada sanksi adat bagi pelanggar",
                    "Diakui sebagai sistem konservasi tradisional"
                ]
            },
            {
                id: 3,
                judul: "Bakar Batu",
                gambar: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRxGsia5HvHLL_NdbnGxrxLv0kc3terMm-e6g&s",
                deskripsiSingkat: "Tradisi memasak bersama dengan batu panas",
                deskripsiPanjang: "Bakar Batu atau Barapen adalah tradisi memasak bersama masyarakat Papua dengan menggunakan batu yang dipanaskan. Tradisi ini biasanya dilakukan dalam acara-acara penting seperti pernikahan, penyambutan tamu, atau upacara adat.",
                fakta: [
                    "Dilakukan untuk acara-acara penting",
                    "Melibatkan seluruh anggota komunitas",
                    "Menggunakan batu vulkanik yang dipanaskan",
                    "Simbol persatuan dan kebersamaan",
                    "Masakan dimasak dalam lubang tanah"
                ]
            }
        ],
        coordinates: [ -4.2699, 138.0804 ] // Koordinat untuk Papua
    }
};

// State Management
let currentRegion = null;
let modalOpen = false;
let map = null;

// DOM Elements
const loadingScreen = document.getElementById('loading-screen');
const progressBar = document.getElementById('progress-bar');
const contentArea = document.getElementById('content-area');
const modalOverlay = document.getElementById('modal-overlay');
const modalContainer = document.getElementById('modal-container');
const modalContent = document.getElementById('modal-content');
const modalClose = document.getElementById('modal-close');
const backToTop = document.getElementById('back-to-top');
const floatingNav = document.querySelector('.floating-nav');
const navButtons = document.querySelectorAll('.nav-container button');

// Initialize Application
document.addEventListener('DOMContentLoaded', async () => {
    // Initialize loading
    simulateLoading();
    
    // Initialize map after loading
    setTimeout(() => {
        initMap();
        initEventListeners();
        initScrollEffects();
        console.log('Website Kearifan Lokal Indonesia siap!');
    }, 1500);
});

// Simulate Loading with Progress
function simulateLoading() {
    let progress = 0;
    const interval = setInterval(() => {
        progress += Math.random() * 10;
        if (progress > 100) {
            progress = 100;
            clearInterval(interval);
            setTimeout(() => {
                loadingScreen.classList.add('hidden');
            }, 500);
        }
        progressBar.style.width = `${progress}%`;
    }, 100);
}

// Initialize Leaflet Map
function initMap() {
    // Create map centered on Indonesia
    map = L.map('indonesiaMap').setView([-2.5489, 118.0149], 5);
    
    // Add OpenStreetMap tile layer
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap contributors',
        maxZoom: 12,
        minZoom: 3
    }).addTo(map);
    
    // Add markers for each region
    addRegionMarkers();
    
    // Fit bounds to Indonesia
    map.fitBounds([
        [-11.0, 94.0], // Southwest corner
        [6.0, 141.0]   // Northeast corner
    ]);
}

// Add markers for each region
function addRegionMarkers() {
    const regionColors = {
        'sumatera-barat': '#2E8B57',
        'yogyakarta': '#FFD700',
        'bali': '#DC143C',
        'toraja': '#8B4513',
        'papua': '#1E90FF'
    };
    
    Object.keys(budayaData).forEach(regionId => {
        const region = budayaData[regionId];
        const color = regionColors[regionId] || '#333333';
        
        // Create custom icon
        const customIcon = L.divIcon({
            html: `
                <div style="
                    width: 40px;
                    height: 40px;
                    background: ${color};
                    border: 3px solid white;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    color: white;
                    font-weight: bold;
                    box-shadow: 0 2px 5px rgba(0,0,0,0.3);
                    cursor: pointer;
                    transition: all 0.3s ease;
                " class="map-marker">
                    <i class="fas fa-map-marker-alt"></i>
                </div>
            `,
            className: 'custom-div-icon',
            iconSize: [40, 40],
            iconAnchor: [20, 40],
            popupAnchor: [0, -40]
        });
        
        // Add marker to map
        const marker = L.marker(region.coordinates, { icon: customIcon }).addTo(map);
        
        // Add popup
        marker.bindPopup(`
            <div style="padding: 10px;">
                <h3 style="margin: 0 0 10px 0; color: ${color};">
                    ${region.nama}
                </h3>
                <p style="margin: 0 0 10px 0;">
                    ${region.deskripsi.substring(0, 150)}...
                </p>
                <button onclick="loadRegionContent('${regionId}')" 
                        style="
                            background: ${color};
                            color: white;
                            border: none;
                            padding: 8px 16px;
                            border-radius: 4px;
                            cursor: pointer;
                            font-weight: bold;
                        ">
                    Jelajahi Kearifan
                </button>
            </div>
        `);
        
        // Add click event
        marker.on('click', function() {
            loadRegionContent(regionId);
            updateActiveNav(regionId);
            smoothScrollTo('.content-section', 800);
        });
    });
}

// Event Listeners Initialization
function initEventListeners() {
    // Region click events
    document.querySelectorAll('.region-card, .footer-nav a').forEach(element => {
        element.addEventListener('click', function(e) {
            e.preventDefault();
            const region = this.getAttribute('data-region');
            if (region && budayaData[region]) {
                loadRegionContent(region);
                updateActiveNav(region);
                smoothScrollTo('.content-section', 800);
            }
        });
    });

    // Floating navigation
    navButtons.forEach(button => {
        button.addEventListener('click', function() {
            const target = this.getAttribute('data-target');
            if (target === 'home') {
                showWelcomeContent();
                updateActiveNav('home');
                smoothScrollTo('.main-header', 800);
            } else if (budayaData[target]) {
                loadRegionContent(target);
                updateActiveNav(target);
                smoothScrollTo('.content-section', 800);
            }
        });
    });

    // Modal events
    modalOverlay.addEventListener('click', closeModal);
    modalClose.addEventListener('click', closeModal);
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && modalOpen) closeModal();
    });

    // Back to top
    backToTop.addEventListener('click', () => {
        smoothScrollTo('.main-header', 800);
    });

    // Delegated event listeners
    contentArea.addEventListener('click', (e) => {
        // Learn more buttons
        if (e.target.classList.contains('learn-more-btn') || 
            e.target.closest('.learn-more-btn')) {
            e.preventDefault();
            const card = e.target.closest('.wisdom-card');
            const regionId = currentRegion;
            const wisdomId = parseInt(card.getAttribute('data-wisdom-id'));
            
            if (regionId && wisdomId) {
                openModal(regionId, wisdomId);
            }
        }
        
        // Back to map button
        if (e.target.classList.contains('back-to-map-btn') || 
            e.target.closest('.back-to-map-btn')) {
            e.preventDefault();
            showWelcomeContent();
            updateActiveNav('home');
        }
    });
}

// Smooth Scroll Function
function smoothScrollTo(selector, duration) {
    const target = document.querySelector(selector);
    if (!target) return;
    
    const targetPosition = target.getBoundingClientRect().top + window.pageYOffset;
    const startPosition = window.pageYOffset;
    const distance = targetPosition - startPosition;
    let startTime = null;
    
    function animation(currentTime) {
        if (startTime === null) startTime = currentTime;
        const timeElapsed = currentTime - startTime;
        const run = ease(timeElapsed, startPosition, distance, duration);
        window.scrollTo(0, run);
        if (timeElapsed < duration) requestAnimationFrame(animation);
    }
    
    // Easing function
    function ease(t, b, c, d) {
        t /= d / 2;
        if (t < 1) return c / 2 * t * t + b;
        t--;
        return -c / 2 * (t * (t - 2) - 1) + b;
    }
    
    requestAnimationFrame(animation);
}

// Load Region Content
function loadRegionContent(regionId) {
    if (!budayaData[regionId]) return;
    
    currentRegion = regionId;
    const region = budayaData[regionId];
    
    // Create loading effect
    contentArea.innerHTML = `
        <div class="loading-region fade-in">
            <div class="loading-spinner"></div>
            <p>Memuat kearifan lokal ${region.nama}...</p>
        </div>
    `;
    
    // Simulate loading delay for better UX
    setTimeout(() => {
        const content = `
            <div class="region-content fade-in">
                <!-- Region Header -->
                <div class="region-header">
                    <img src="${region.fotoUtama}" alt="${region.nama}" class="region-bg" loading="lazy">
                    <div class="region-title-overlay">
                        <h2 class="region-title">${region.nama}</h2>
                        <p class="region-desc">Kearifan Lokal yang Menginspirasi</p>
                    </div>
                </div>
                
                <!-- Region Body -->
                <div class="region-body">
                    <!-- Introduction -->
                    <div class="region-intro">
                        ${region.deskripsi}
                    </div>
                    
                    <!-- Wisdom Cards -->
                    <div class="wisdom-cards">
                        ${region.kearifan.map((wisdom, index) => `
                            <div class="wisdom-card" data-wisdom-id="${wisdom.id}">
                                <img src="${wisdom.gambar}" alt="${wisdom.judul}" class="wisdom-card-img" loading="lazy">
                                <div class="wisdom-card-content">
                                    <h3 class="wisdom-card-title">${wisdom.judul}</h3>
                                    <p class="wisdom-card-desc">${wisdom.deskripsiSingkat}</p>
                                    
                                    <!-- Image Gallery Section (Pengganti Video) -->
                                    <div class="image-gallery-section">
                                        <div class="image-gallery-placeholder">
                                            <img src="${wisdom.gambar}" 
                                                 alt="Galeri ${wisdom.judul}" 
                                                 loading="lazy"
                                                 class="gallery-main-image">
                                            <div class="gallery-info">
                                                <p><i class="fas fa-image"></i> Klik untuk melihat lebih detail</p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <button class="learn-more-btn">
                                        Pelajari Lebih Lanjut
                                        <i class="fas fa-arrow-right"></i>
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <!-- Back to Map Button -->
                    <div style="text-align: center;">
                        <button class="back-to-map-btn">
                            <i class="fas fa-map"></i>
                            Kembali ke Peta
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        contentArea.innerHTML = content;
        
        // Add animations to cards
        const cards = document.querySelectorAll('.wisdom-card');
        cards.forEach((card, index) => {
            card.style.animationDelay = `${index * 0.1}s`;
            card.classList.add('fade-in');
        });
        
        // Update browser history
        history.pushState({ region: regionId }, '', `#${regionId}`);
    }, 500);
}

// Show Welcome Content
function showWelcomeContent() {
    currentRegion = null;
    
    const welcomeContent = `
        <div class="welcome-content fade-in">
            <div class="welcome-icon">
                <i class="fas fa-compass"></i>
            </div>
            <h2 class="welcome-title">Selamat Datang di Portal Kearifan Lokal Indonesia</h2>
            <p class="welcome-text">
                Indonesia adalah negara dengan kekayaan budaya yang luar biasa. Setiap wilayah memiliki kearifan lokal yang unik dan bernilai tinggi. 
                Pilih salah satu wilayah di peta atau navigasi cepat di bawah untuk memulai eksplorasi Anda.
            </p>
            
            <!-- Welcome Images -->
            <div class="welcome-images">
                <div class="welcome-image-item">
                    <img src="https://images.unsplash.com/photo-1552465011-b4e30bf7349d?q=80&w=3840&auto=format&fit=crop" 
                         alt="Budaya Indonesia" 
                         loading="lazy">
                    <p class="image-caption">Keindahan Alam dan Budaya Nusantara</p>
                </div>
                <div class="welcome-image-item">
                    <img src="https://images.unsplash.com/photo-1528164344705-47542687000d?q=80&w=3869&auto=format&fit=crop" 
                         alt="Tradisi Indonesia" 
                         loading="lazy">
                    <p class="image-caption">Ragam Tradisi yang Tetap Lestari</p>
                </div>
            </div>
            
            <div class="welcome-tip">
                <i class="fas fa-lightbulb"></i>
                <span>Tips: Anda juga bisa menggunakan navigasi di samping untuk langsung menuju ke wilayah tertentu</span>
            </div>
        </div>
    `;
    
    contentArea.innerHTML = welcomeContent;
    history.pushState({}, '', '#');
}

// Update Active Navigation
function updateActiveNav(region) {
    navButtons.forEach(button => {
        button.classList.remove('active');
        const target = button.getAttribute('data-target');
        if (target === region || (region === 'home' && target === 'home')) {
            button.classList.add('active');
        }
    });
}

// Open Modal
function openModal(regionId, wisdomId) {
    const region = budayaData[regionId];
    const wisdom = region.kearifan.find(w => w.id === wisdomId);
    
    if (!wisdom) return;
    
    modalContent.innerHTML = `
        <div class="modal-header">
            <h3 class="modal-title">${wisdom.judul}</h3>
            <p class="modal-subtitle">${region.nama}</p>
        </div>
        
        <div class="modal-body">
            <div class="modal-image-container">
                <img src="${wisdom.gambar}" alt="${wisdom.judul}" class="modal-image" loading="lazy">
            </div>
            
            <div class="modal-description">
                <p class="modal-desc">${wisdom.deskripsiPanjang}</p>
            </div>
        </div>
        
        <div class="modal-facts">
            <h4><i class="fas fa-info-circle"></i> Fakta Menarik:</h4>
            <ul>
                ${wisdom.fakta.map(fact => `<li>${fact}</li>`).join('')}
            </ul>
        </div>
        
        <!-- Additional Images Section -->
        <div class="additional-images-section">
            <h4><i class="fas fa-images"></i> Galeri Gambar</h4>
            <div class="images-grid">
                <div class="grid-image-item">
                    <img src="${wisdom.gambar}" 
                         alt="${wisdom.judul} - Detail 1" 
                         loading="lazy"
                         class="grid-image">
                </div>
                <div class="grid-image-item">
                    <img src="${region.fotoUtama}" 
                         alt="${region.nama}" 
                         loading="lazy"
                         class="grid-image">
                </div>
            </div>
        </div>
    `;
    
    modalOpen = true;
    document.body.style.overflow = 'hidden';
    modalOverlay.classList.add('active');
    modalContainer.classList.add('active');
}

// Close Modal
function closeModal() {
    modalOpen = false;
    document.body.style.overflow = 'auto';
    modalOverlay.classList.remove('active');
    modalContainer.classList.remove('active');
}

// Scroll Effects
function initScrollEffects() {
    // Back to top button visibility
    window.addEventListener('scroll', () => {
        if (window.scrollY > 300) {
            backToTop.classList.add('visible');
            floatingNav.style.opacity = '0.7';
            floatingNav.style.transform = 'translateY(-50%) scale(0.95)';
        } else {
            backToTop.classList.remove('visible');
            floatingNav.style.opacity = '1';
            floatingNav.style.transform = 'translateY(-50%) scale(1)';
        }
    });
}

// Handle browser back/forward
window.addEventListener('popstate', (event) => {
    if (event.state && event.state.region) {
        loadRegionContent(event.state.region);
        updateActiveNav(event.state.region);
    } else {
        showWelcomeContent();
        updateActiveNav('home');
    }
});

// Add CSS for animations and additional styling
const style = document.createElement('style');
style.textContent = `
    .loading-region {
        text-align: center;
        padding: 100px 20px;
    }
    
    .loading-region .loading-spinner {
        width: 60px;
        height: 60px;
        border: 4px solid rgba(46, 139, 87, 0.1);
        border-top-color: var(--primary-green);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
    }
    
    .loading-region p {
        color: var(--primary-green);
        font-size: 1.2rem;
    }
    
    @keyframes fadeIn {
        from { 
            opacity: 0; 
            transform: translateY(20px); 
        }
        to { 
            opacity: 1; 
            transform: translateY(0); 
        }
    }
    
    .fade-in {
        animation: fadeIn 0.6s ease-out forwards;
    }
    
    /* Custom map marker styles */
    .custom-div-icon {
        background: transparent !important;
        border: none !important;
    }
    
    .map-marker {
        transition: all 0.3s ease !important;
    }
    
    .map-marker:hover {
        transform: scale(1.1) !important;
        box-shadow: 0 4px 10px rgba(0,0,0,0.3) !important;
    }
    
    /* Image Gallery Section */
    .image-gallery-section {
        margin-top: 15px;
    }
    
    .image-gallery-placeholder {
        position: relative;
        width: 100%;
        height: 180px;
        background: var(--neutral-light);
        border-radius: var(--radius-md);
        overflow: hidden;
        cursor: pointer;
        border: 2px solid rgba(46, 139, 87, 0.1);
    }
    
    .gallery-main-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.5s ease;
    }
    
    .image-gallery-placeholder:hover .gallery-main-image {
        transform: scale(1.05);
    }
    
    .gallery-info {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(to top, rgba(0, 0, 0, 0.7), transparent);
        padding: 10px;
        color: white;
        font-size: 0.9rem;
    }
    
    .gallery-info p {
        margin: 0;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    /* Additional Images in Modal */
    .additional-images-section {
        margin-top: 30px;
        padding-top: 20px;
        border-top: 2px solid var(--neutral-light);
    }
    
    .additional-images-section h4 {
        font-family: 'Poppins', sans-serif;
        color: var(--primary-green);
        margin-bottom: 15px;
        font-size: 1.3rem;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .additional-images-section h4 i {
        color: var(--secondary-gold);
    }
    
    .images-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
        margin-top: 10px;
    }
    
    .grid-image-item {
        border-radius: var(--radius-md);
        overflow: hidden;
        height: 150px;
    }
    
    .grid-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.5s ease;
    }
    
    .grid-image:hover {
        transform: scale(1.05);
    }
`;
document.head.appendChild(style);

// Preload critical images
function preloadImages() {
    const criticalImages = [
        'https://assets.mixkit.co/videos/preview/mixkit-forest-stream-in-the-sunlight-529-large.mp4'
    ];
    
    criticalImages.forEach(src => {
        if (src.includes('.mp4')) {
            const video = document.createElement('video');
            video.src = src;
            video.preload = 'auto';
        }
    });
}

// Initialize image preloading
preloadImages();

// Expose loadRegionContent to global scope for map popup buttons
window.loadRegionContent = loadRegionContent;